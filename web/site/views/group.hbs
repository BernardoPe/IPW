<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
   <link rel="stylesheet" type="text/css" href="/site/css"/>
   <title>Group {{group.name}}</title>
</head>

<nav>
    <a href="/site/home">Home</a>
    <a href="/site/search">Search Events</a>
    <a href="/site/groups">Groups</a>
</nav>

<body>




<div class="search-container">
    <h1>Search Events to Add</h1>
    <select onchange="showForm(this.value)">
    <option value="popular">Search Popular Events</option>
    <option value="name">Search Event by Name</option>
    </select>

    <form id="popularForm" action="events/search/popular" method="GET" onsubmit="return validateForm('popularForm   ')">
        <p><input type="text" placeholder="Number of results by page" name="s" value="30"></p>
        <p><input type="text" placeholder="Result page number" name="p" value="1"></p>
        <input type="submit" value="Search Events">
    </form>
    
    <form id="nameForm" action="events/search/name" method="GET" onsubmit="return validateForm('nameForm')" style="display:none;" >
        <p><input type="text" placeholder="Number of results by page" name="s" value="30"></p>
        <p><input type="text" placeholder="Result page number" name="p" value="1"></p>
        <p><input type="text" placeholder="Name of event" name="name"></p>
        <input type="submit" value="Search Events">
    </form>
    
    <div class="error-message" id="errorMessage"></div>
</div>

<div class="group">
    <h2>{{group.name}}</h1>
    <p>{{group.description}}</p>
    <h3>Events:</h3>

    <div class="events">

    {{#if group.events.length}}

        {{#each group.events}}
            <div class="event">
            <h3>{{name}}</h3>
                {{#if date}}
                    <p>Date: {{date}}</p>
                {{/if}}
                {{#if genre}}
                    <p>Genre: {{genre}}</p>
                {{/if}}
                {{#if segment}}
                    <p>Segment: {{segment}}</p>
                {{/if}}
                <div class="bottom-buttons">
                <form id="nameForm" action="/site/event" method="GET">
                    <input type="hidden" name="id" value="{{id}}">
                    <input type="submit" value="More Details...">
                </form>

                <form id="removeForm" action="events/delete" method="POST">
                    <input type="hidden" name="id" value="{{id}}">
                    <input type="submit" value="Remove From Group">
                </form>
                </div>
            </div>
        {{/each}}
    {{/if}}

     </div>
    </div>  
</body> 

    <script>
        function showForm(formType) {
            var popularForm = document.getElementById("popularForm");
            var nameForm = document.getElementById("nameForm");

            if (formType === "popular") {
                popularForm.style.display = "block";
                nameForm.style.display = "none";
            } else if (formType === "name") {
                popularForm.style.display = "none";
                nameForm.style.display = "block";
            }
        }


        function validateForm(formId) {

        var form = document.getElementById(formId);

        var s = parseInt(form.querySelector('input[name="s"]').value);
        var p = parseInt(form.querySelector('input[name="p"]').value);

        var maxResults = 1000;
        var maxResultsPerPage = 200;

        var errorMessage = document.getElementById("errorMessage");

        if(isNaN(s) || s > maxResultsPerPage) {
            errorMessage.textContent = `Invalid values. Maximum number of results per page is ${maxResultsPerPage}`;
            errorMessage.style.display = "block";
            return false;
        }

        if(formId == 'nameForm') {
            var name = form.querySelector('input[name="name"]').value
            if(!name) {
                errorMessage.textContent = `No name provided`;
                errorMessage.style.display = "block";
                return false
            }
        }

        if (isNaN(s) || isNaN(p) || s * p >= maxResults) {
            errorMessage.textContent = `Invalid values. Maximum number of results is ${maxResults}`;
            errorMessage.style.display = "block";
            return false;
        }

        errorMessage.style.display = "none";
        return true;
    }
    </script>

</html>